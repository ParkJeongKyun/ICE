(function(){"use strict";const h=[];let C=0,A=null,E=!1;async function S(){for(;C<8&&h.length>0;){h.sort((s,o)=>s.priority-o.priority),C++;const t=h.shift();try{const o=await t.file.slice(t.offset,t.offset+t.length).arrayBuffer(),r=new Uint8Array(o);self.postMessage({type:"CHUNK_DATA",offset:t.offset,data:r})}catch(s){self.postMessage({type:"ERROR",error:s.message,offset:t.offset})}finally{C--,S()}}}self.addEventListener("message",t=>{const{type:s,file:o,offset:r,length:l,priority:f=r,pattern:c,ignoreCase:a,searchId:e}=t.data;if(s==="CANCEL_SEARCH"){E=!0;return}(s==="SEARCH_HEX"||s==="SEARCH_ASCII")&&(E=!1,A=e,R(o,c,s==="SEARCH_HEX"?"HEX":"ASCII",a,e)),s==="READ_CHUNK"&&(h.push({file:o,offset:r,length:l,priority:f}),S())});function H(t,s,o=!1,r=1e3){const l=[],f=s.length,c=t.length;if(f===0||c===0||f>c)return l;const a=new Array(256).fill(f);for(let n=0;n<f-1;n++){let i=s[n];o&&i>=65&&i<=90&&(i+=32),a[i]=f-1-n}let e=0;for(;e<=c-f;){let n=f-1;for(;n>=0;){let i=t[e+n],u=s[n];if(o&&(i>=65&&i<=90&&(i+=32),u>=65&&u<=90&&(u+=32)),i!==u)break;n--}if(n<0){if(l.push(e),l.length>=r)break;e+=f}else{let i=a[t[e+f-1]];o&&t[e+f-1]>=65&&t[e+f-1]<=90&&(i=a[t[e+f-1]+32]),e+=i>0?i:1}}return l}async function R(t,s,o,r=!1,l){const c=t.size,a=[];let e=0,n=0;for(;e<c;){if(E)return;const i=Math.min(1048576,c-e),I=await t.slice(e,e+i).arrayBuffer(),_=new Uint8Array(I),b=H(_,s,o==="ASCII"?r:!1,1e3-n);for(const g of b)if(a.push({index:e+g,offset:s.length}),n++,n>=1e3)break;if(n>=1e3)break;e+=1048576}(!E||l===A)&&self.postMessage({type:o==="HEX"?"SEARCH_RESULT_HEX":"SEARCH_RESULT_ASCII",results:a,searchId:l})}})();
